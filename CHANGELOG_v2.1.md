# 网络流量监控系统 - 更新说明 (v2.1)

**更新日期：** 2026-02-23  
**版本：** v2.1

---

## 📋 本次修复的问题

### 1. 网络速度图表 Y 轴刻度优化 ✅

**问题：** Y 轴固定显示 MB/s 单位，小数值时显示不直观（如 0.00 MB/s）

**修复：**
- Y 轴标签现在根据数值大小自动选择合适的单位
- < 1024 bytes/s → 显示 B/s
- < 1024 KB/s → 显示 KB/s  
- ≥ 1024 KB/s → 显示 MB/s

**示例：**
```
500 B/s      (之前：0.00 MB/s)
25 KB/s      (之前：0.02 MB/s)
1.5 MB/s     (之前：1.50 MB/s)
```

---

### 2. 总接收/总发送显示时间范围 ✅

**问题：** "总接收（累计）"和"总发送（累计）"没有时间上下文

**修复：**
- 新增"数据时间范围"统计项
- 显示当前查询的时间段
- 累计值下方显示时间范围

**显示示例：**
```
数据时间范围：2026-02-23 10:31:29 至 2026-02-23 10:56:31
总接收（系统累计）：94.55 MB
总发送（系统累计）：15.32 MB
```

---

### 3. 增量接收/增量发送含义澄清 ✅

**问题：** 用户不清楚"增量接收"、"增量发送"是什么

**修复：**
- 标签改为"期间接收总量"、"期间发送总量"
- 明确显示的是选定时间段内的总流量
- 计算方式：该时间段内所有增量值的总和

**说明：**
- **期间接收总量** = 选定时间段内每 5 分钟增量的总和
- **期间发送总量** = 选定时间段内每 5 分钟增量的总和
- **不是**某个时间点的最大值

**示例：**
```
时间段：10:30 - 11:00 (6 个数据点)
每 5 分钟增量：[0, 300KB, 0, 318KB, 299KB, 250KB]
期间接收总量 = 0 + 300 + 0 + 318 + 299 + 250 = 1,167 KB
```

---

### 4. 统计指标按相关性分行显示 ✅

**问题：** 所有统计项挤在一起，不够清晰

**修复：**
- 分为 3 行显示，按相关性分组

**布局：**
```
第一行（数据范围）：
├─ 数据时间范围
├─ 总接收（系统累计）
└─ 总发送（系统累计）

第二行（流量统计）：
├─ 期间接收总量
├─ 期间发送总量
└─ 数据点数

第三行（速度信息）：
├─ 最新下载速度 ↓
├─ 最新上传速度 ↑
└─ 最后更新时间
```

---

## 📊 页面布局对比

### 之前
```
┌─────────────────────────────────────────────┐
│ [总接收] [总发送] [增量接收] [增量发送]     │
│ [数据点数] [最新速度↓] [最新速度↑]          │
└─────────────────────────────────────────────┘
```

### 现在
```
┌─────────────────────────────────────────────┐
│ [数据时间范围] [总接收] [总发送]            │  ← 第一行
├─────────────────────────────────────────────┤
│ [期间接收总量] [期间发送总量] [数据点数]    │  ← 第二行
├─────────────────────────────────────────────┤
│ [最新下载↓] [最新上传↑] [最后更新]          │  ← 第三行
└─────────────────────────────────────────────┘
```

---

## 🔧 技术修改

### 前端 (`templates/index.html`)

1. **CSS 修改：**
   - 新增 `.stats-row` 类用于分行布局
   - 修改 `.stat-item` 为弹性布局

2. **HTML 修改：**
   - 统计项分为 3 个 `.stats-row`
   - 更新标签文字
   - 新增时间范围显示元素

3. **JavaScript 修改：**
   - 新增时间范围计算和显示逻辑
   - 修改增量总和的计算说明
   - 优化 `formatSpeed()` 函数自动选择单位
   - 速度图表 Y 轴标签动态选择单位

---

## 📝 指标说明

| 指标 | 含义 | 计算方式 |
|------|------|---------|
| **数据时间范围** | 当前显示的数据时间段 | 第一个和最后一个数据点的时间 |
| **总接收（系统累计）** | 系统启动以来接收的总流量 | macOS nettop 返回的累计值 |
| **总发送（系统累计）** | 系统启动以来发送的总流量 | macOS nettop 返回的累计值 |
| **期间接收总量** | 选定时间段内的总接收流量 | 该时间段内所有增量值之和 |
| **期间发送总量** | 选定时间段内的总发送流量 | 该时间段内所有增量值之和 |
| **数据点数** | 选定时间段内的数据记录数 | 数据库记录条数 |
| **最新下载速度** | 最近一次采集的下载速度 | 最后一次采集的速度值 |
| **最新上传速度** | 最近一次采集的上传速度 | 最后一次采集的速度值 |
| **最后更新时间** | 页面最后刷新时间 | 当前系统时间 |

---

## 🌐 访问

刷新页面 http://localhost:5003/ 即可看到更新后的界面！

---

**版本历史：**
- v2.1 (2026-02-23) - 修复 Y 轴刻度、时间范围、指标布局
- v2.0 (2026-02-23) - 增量流量、告警、CSV 导出、暗色主题
- v1.0 (2026-02-22) - 初始版本
